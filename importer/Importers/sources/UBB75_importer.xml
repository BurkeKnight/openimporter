// Note: this is broken

<?xml version="1.0"?>
<importer xmlns="http://www.elkarte.net/xml/importer" xmlns:smf="http://www.elkarte.net/">
	<general>
		<name>UBB Threads 7.5.x</name>
		<version>ElkArte 1.0</version>
		<className>UBB_7_5</className>
	</general>
	<step id="members" type="mandatory">
		<title>Importing members</title>
		<detect>{$from_prefix}USERS</detect>
		<preparsecode>
			$row['signature'] = fix_quotes($row['signature'], false);
			$row['birthdate'] = convert_birthdate($row['birthdate']);
		</preparsecode>
		<query>
			SELECT
				m.USER_ID AS id_member, SUBSTRING(m.USER_LOGIN_NAME, 1, 80) AS member_name,
				IFNULL(m.USER_REGISTERED_ON, 0) AS date_registered, up.USER_TOTAL_POSTS as posts,
				CASE
					WHEN m.USER_MEMBERSHIP_LEVEL = 'Administrator' THEN 1
					WHEN m.USER_MEMBERSHIP_LEVEL = 'Moderator' THEN 3
					ELSE 0
				END as id_group,
				IFNULL(ud.USER_LAST_VISIT_TIME, 0) as last_login, SUBSTRING(m.USER_DISPLAY_NAME, 1, 255) AS real_name,
				IFNULL(up.USER_TOTAL_PM, 0) as instant_messages, m.USER_REGISTRATION_EMAIL AS email_address,

				USER_BIRTHDAY as birthdate,

				SUBSTRING(up.USER_HOMEPAGE, 1, 255) AS website_url, up.USER_LOCATION as location,
				SUBSTRING(up.USER_ICQ, 1, 255) AS icq, SUBSTRING(up.USER_AIM, 1, 16) AS aim,
				SUBSTRING(up.USER_YAHOO, 1, 32) AS yim, SUBSTRING(up.USER_MSN, 1, 255) AS msn, m.USER_PASSWORD as passwd,

				CASE
					WHEN up.USER_VISIBLE_ONLINE_STATUS = 'no' THEN 0
					ELSE 1
				END as show_online,
				1 as hide_email, SUBSTRING(up.USER_DEFAULT_SIGNATURE, 1, 65534) AS signature,

				up.USER_AVATAR as avatar,

				m.USER_REGISTRATION_IP AS member_ip, ud.USER_LAST_IP as member_ip2,

				m.USER_IS_APPROVED = 'yes' as is_activated,

				SUBSTRING(m.USER_PASSWORD, 1, 64) AS passwd, '' AS password_salt
			FROM {$from_prefix}USERS AS m
				LEFT JOIN {$from_prefix}USER_PROFILE AS up ON (m.USER_ID = up.USER_ID)
				LEFT JOIN {$from_prefix}USER_DATA as ud ON (m.USER_ID = ud.USER_ID);
		</query>
	</step>
	<step id="categories">
		<title>Importing categories</title>
		<detect>{$from_prefix}CATEGORIES</detect>
		<query>
			SELECT CATEGORY_ID AS id_cat, CATEGORY_TITLE as name, CATEGORY_SORT_ORDER AS cat_order
			FROM {$from_prefix}CATEGORIES;
		</query>
	</step>
	<step id="boards">
		<title>Importing boards</title>
		<detect>{$from_prefix}FORUMS</detect>
		<preparsecode>
			$row['description'] = fix_quotes($row['description'], false);
		</preparsecode>
		<query>
			SELECT
				FORUM_ID AS id_board, CATEGORY_ID as id_cat, SUBSTRING(FORUM_TITLE, 1, 255) AS name,
				SUBSTRING(FORUM_DESCRIPTION, 1, 65534) AS description, FORUM_SORT_ORDER AS board_order,
				FORUM_POSTS AS num_posts, IFNULL(FORUM_PARENT, 0) as id_parent, FORUM_POSTS_COUNT AS count_posts, 
				'' AS member_groups
			FROM {$from_prefix}FORUMS;
		</query>
	</step>
</importer>